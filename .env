# Server Configuration
PORT=3000

# Database Configuration
# Database Configuration (based on PostgreSQL optimization script)
# PostgreSQL max_connections = 132 (8 CPU cores * 4 + 100)
# Application pools use ~60% of total capacity (80 connections)
PROJECTION_BATCH_TIMEOUT_MS=25
CDC_WRITE_BATCH_TIMEOUT_MS=100
PROJECTION_ACQUIRE_TIMEOUT=45
DB_BATCH_TIMEOUT_MS=25
PROJECTION_BATCH_SIZE=5000
DB_BATCH_SIZE=5000
DB_MAX_BATCH_QUEUE_SIZE=20000
DB_MAX_CONNECTIONS=400
DB_MIN_CONNECTIONS=250
DB_ACQUIRE_TIMEOUT=45
DB_IDLE_TIMEOUT=300
DB_MAX_LIFETIME=900
DB_BATCH_PROCESSOR_COUNT=32
DB_WRITE_MAX_LIFETIME=900
DB_SNAPSHOT_THRESHOLD=500
DB_SNAPSHOT_INTERVAL=300
DB_SNAPSHOT_CACHE_TTL=1800
DB_MAX_SNAPSHOTS_PER_RUN=20
DB_LOCK_TIMEOUT=100
DB_IDLE_IN_TRANSACTION_TIMEOUT=30000
DB_OPERATION_TIMEOUT=10
TRANSACTION_TIMEOUT=15
CONNECTION_ACQUIRE_TIMEOUT=15
LOCK_TIMEOUT=100
RETRY_TIMEOUT=2
WRITE_AGGREGATES_PER_PARTITION=1000

BATCHING_STRATEGY=auto
CDC_BATCH_SIZE=5000
CDC_BATCH_TIMEOUT_MS=25
CDC_POLL_INTERVAL_MS=5
CDC_MAX_CONCURRENT_AGGREGATES=8
CDC_CACHE_LOCK_TIMEOUT=10
CDC_CONNECTION_RETRY_COUNT=3
CDC_CONNECTION_RETRY_DELAY=100
CDC_MAX_CONCURRENT_TASKS=32
CDC_SEMAPHORE_PERMITS=32
CDC_NUM_PARTITIONS=8
CDC_OFFSET_COMMIT_SLEEP_MS=10
CDC_OFFSET_COMMIT_BATCH_SIZE=5000
CDC_OFFSET_COMMIT_TIMEOUT_MS=25
CDC_DLQ_BATCH_SIZE=100
CDC_DLQ_TIMEOUT_MS=50
ENABLE_COPY_OPTIMIZATION=true
PROJECTION_COPY_THRESHOLD=1000
TRANSACTION_COPY_THRESHOLD=1000
CDC_PROJECTION_BATCH_SIZE=5000
ENABLE_COPY_PERFORMANCE_LOGGING=true
COPY_METRICS_REPORT_INTERVAL=60
COPY_SLOW_QUERY_THRESHOLD_MS=1000
ENABLE_ADAPTIVE_BATCH_SIZING=false
MIN_ADAPTIVE_BATCH_SIZE=5000
CDC_COMMIT_EVERY_N_BATCHES=8
# Maximum batch size for adaptive sizing (default: 5000)
MAX_ADAPTIVE_BATCH_SIZE=20000

# System load threshold for reducing batch size (0.0-1.0, default: 0.8)
HIGH_LOAD_THRESHOLD=0.8
# Number of retries for COPY operations before falling back to UNNEST (default: 2)
COPY_RETRY_COUNT=2

# Delay between COPY retries in milliseconds (default: 100)
COPY_RETRY_DELAY_MS=100

# Enable automatic fallback to UNNEST on COPY failure (default: true)
ENABLE_COPY_FALLBACK=true

# Pool Configuration (aligned with PostgreSQL recommendations)
POOL_MAX_CONNECTIONS=400
POOL_MIN_CONNECTIONS=250
POOL_HEALTH_CHECK_INTERVAL=10
POOL_EXHAUSTION_THRESHOLD=0.8
POOL_AUTO_SCALING=true
POOL_CONNECTION_TIMEOUT=10
POOL_MAX_WAIT_TIME=2
WRITE_POOL_SIZE=400


# Authentication Configuration
JWT_SECRET=default_secret
REFRESH_TOKEN_SECRET=default_refresh_secret
ACCESS_TOKEN_EXPIRY=3600
REFRESH_TOKEN_EXPIRY=604800
RATE_LIMIT_REQUESTS=1000
RATE_LIMIT_WINDOW=60
MAX_FAILED_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=30

# Cache Configuration
CACHE_DEFAULT_TTL=3600
CACHE_MAX_SIZE=5000
CACHE_SHARD_COUNT=8
CACHE_WARMUP_BATCH_SIZE=50
CACHE_WARMUP_INTERVAL=300
CACHE_OPERATION_TIMEOUT=5
CACHE_MAX_CONCURRENT_READS=16

# Projection Store Configuration
PROJECTION_MAX_CONNECTIONS=400
PROJECTION_MIN_CONNECTIONS=250

# Rate Limiting Configuration
RATE_LIMIT_REQUESTS_PER_MINUTE=100
RATE_LIMIT_BURST_SIZE=20
RATE_LIMIT_WINDOW_SIZE=60
RATE_LIMIT_MAX_CLIENTS=500

# Scaling Configuration
SCALING_MIN_INSTANCES=1
SCALING_MAX_INSTANCES=5
SCALING_UP_THRESHOLD=0.8
SCALING_DOWN_THRESHOLD=0.2
SCALING_COOLDOWN_PERIOD=300
SCALING_HEALTH_CHECK_INTERVAL=30
SCALING_INSTANCE_TIMEOUT=60

# Kafka Configuration
KAFKA_ENABLED=true
KAFKA_BOOTSTRAP_SERVERS=localhost:9092
KAFKA_GROUP_ID=banking-es-group
KAFKA_TOPIC_PREFIX=banking-es
KAFKA_PRODUCER_ACKS=1
KAFKA_PRODUCER_RETRIES=3
KAFKA_PRODUCER_BATCH_SIZE=65536
KAFKA_CONSUMER_MAX_POLL_INTERVAL_MS=300000
KAFKA_CONSUMER_SESSION_TIMEOUT_MS=30000
KAFKA_CONSUMER_MAX_POLL_RECORDS=5000
KAFKA_FETCH_MAX_BYTES= 5*1024*1024
KAFKA_SECURITY_PROTOCOL=PLAINTEXT
KAFKA_SASL_MECHANISM=PLAIN
KAFKA_CONSUMER_HEARTBEAT_INTERVAL_MS=3000
KAFKA_FETCH_MIN_BYTES=1

CDC_TOPIC=banking-es.public.kafka_outbox_cdc

#KAFKA_SSL_CA_LOCATION=
KAFKA_AUTO_OFFSET_RESET=latest

# Test Mode (set to true for testing)
RUST_TEST=false

# redis url
# Used for caching, event batching, and command de-duplication.
REDIS_URL=redis://127.0.0.1:6379
DATABASE_URL=postgresql://postgres:Francisco1@127.0.0.1:5432/banking_es
# DATA_CAPTURE_METHOD=outbox_poller
DATA_CAPTURE_METHOD=cdc_debezium
# Application Configuration
MAX_CONCURRENT_OPERATIONS=500
BATCH_FLUSH_INTERVAL_MS=10
REDIS_MAX_CONNECTIONS=200
REDIS_MIN_CONNECTIONS=50
REDIS_CONNECTION_TIMEOUT=5
REDIS_IDLE_TIMEOUT=300
REDIS_OPERATION_TIMEOUT=5

KAFKA_FETCH_MAX_WAIT_MS=25
KAFKA_OPERATION_TIMEOUT=10
KAFKA_MAX_POLL_INTERVAL_MS=30000
KAFKA_SESSION_TIMEOUT_MS=30000
KAFKA_MAX_POLL_RECORDS=5000
KAFKA_RECONNECT_BACKOFF_MAX_MS=1000
DEADLOCK_CHECK_INTERVAL=3
DEADLOCK_OPERATION_TIMEOUT=30
ENABLE_AUTO_RESOLUTION=true

MAX_REQUESTS_PER_SECOND=2000

LOCK_TIMEOUT_MS=5000
CACHE_LOCK_TIMEOUT_MS=5000
PROJECTION_CACHE_LOCK_TIMEOUT_MS=5000
MAX_CONCURRENT_CACHE_OPERATIONS=32
CACHE_BATCH_SIZE=100


KAFKA_BATCH_SIZE=65536
KAFKA_LINGER_MS=10
KAFKA_ACKS=1
KAFKA_COMPRESSION_TYPE=snappy
CONSISTENCY_TIMEOUT_SECS=5
CONSISTENCY_CLEANUP_INTERVAL_SECS=30
READ_TIMEOUT_SECS=3
CDC_POLL_INTERVAL_MS=100
